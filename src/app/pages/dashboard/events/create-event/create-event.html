<div class="flex min-h-screen relative flex-col lg:flex-row">

  <aside class="flex-row w-full lg:flex-col lg:w-64 bg-white border-r border-gray-200 p-6 space-y-6 xl:fixed">
    <a routerLink="/dashboard/events" class="cursor-pointer text-violet-600 font-medium flex items-center gap-2">
      <ng-icon name="ionChevronBack" style="width: 22px; height: 22px" />
      Back to events
    </a>


    <div class="p-4 rounded-xl shadow-sm border border-gray-200 bg-white">
      <p class="font-semibold text-gray-800">
        {{ createEventForm.value.title || "Event Title" }}
      </p>
      <p class="text-sm text-gray-500 dark:text-gray-400">
        {{ createEventForm.value.event_date | date }},
        {{ createEventForm.value.event_time || "--:-- " }}
      </p>
      <div class="mt-3 flex items-center gap-2">
        <button class="text-gray-700 cursor-pointer border border-gray-300 bg-transparent rounded-md text-sm px-3 py-1">
          Draft
        </button>
        <p class="text-[15px] text-gray-500">
          {{ isEditMode ? "Edit mode" : "Create mode" }}
        </p>
      </div>
    </div>
  </aside>


  <main class="flex-1 p-6 overflow-y-auto xl:ml-64 xl:px-30">

    <div
      class="relative rounded-lg overflow-hidden border-2 border-dashed border-violet-300 bg-violet-50 flex items-center justify-center h-[350px] mb-10 group">
      @if (createEventForm.value.image) {
      <img [src]="createEventForm.value.image" alt="Event image" class="w-full h-full object-fit" />
      <button (click)="removeImage()"
        class="absolute top-3 right-3 bg-white text-violet-600 hover:bg-red-400 hover:text-white rounded-full p-2 cursor-pointer opacity-0 group-hover:opacity-100 transition-all duration-300 shadow-md"
        title="Remove image">
        <ng-icon name="ionTrashOutline" style="width: 20px; height: 20px" />
      </button>
      } @else {
      <label class="cursor-pointer flex flex-col items-center justify-center text-center text-violet-700">
        <input type="file" hidden (change)="onImageSelect($event)" accept=".jpg,.jpeg,.png" />
        <div
          class="bg-white rounded-md px-5 py-3 shadow-sm border border-violet-200 flex flex-col items-center justify-center">
          <ng-icon name="ionCloudUpload" style="width: 40px; height: 40px" />

          <span class="font-medium">Upload photo</span>
        </div>
      </label>
      }
    </div>


    <section class="bg-white rounded-md p-8 shadow-sm border border-gray-200">
      <h2 class="text-2xl font-bold text-gray-800 mb-6">Event Overview</h2>

      <form class="space-y-6" [formGroup]="createEventForm">

        <div>
          <label class="block font-semibold mb-2 text-gray-700">Event title <span class="text-red-400">*</span></label>
          <input formControlName="title" [ngClass]="{
            'ring-red-400':
              createEventForm.get('title')?.errors &&
              createEventForm.get('title')?.touched
          }" name="title" type="text" required placeholder="Event Title"
            class="placeholder:text-slate-400 placeholder:text-[14px] placeholder:italic w-full border border-gray-300 rounded-md p-3 focus:ring-2 focus:ring-violet-500 outline-none" />
          @if(createEventForm.get('title')?.touched &&
          createEventForm.get('title')?.errors?.['required']){

          <p class="text-[13px] text-red-400">
            Please this field must not be empty
          </p>
          }
        </div>

        <!-- Summary -->
        <div>
          <label class="block font-semibold mb-2 text-gray-700">Summary <span class="text-red-400">*</span></label>
          <textarea formControlName="description" name="description" rows="3" 
            placeholder="Short description of your event..."
            class="placeholder:text-slate-400 placeholder:text-[14px] placeholder:italic w-full border border-gray-300 rounded-md p-3 focus:ring-2 focus:ring-violet-500 outline-none"></textarea>

          @if(createEventForm.get('description')?.touched){
          @if(createEventForm.get('description')?.errors?.['required']){

          <p class="text-[13px] text-red-400">
            Please give a little description about this event
          </p>
          }@else if (createEventForm.get('description')?.errors?.['maxlength']) {
          <p class="text-[13px] text-red-400">
            Description must not be more than 150 charaters
          </p>
          }}
          <p class="text-gray-400 text-xs mt-1">Max 150 characters</p>
        </div>


        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
          <div>
            <label class="block font-semibold mb-2 text-gray-700">Event date <span class="text-red-400">*</span></label>
            <input type="date" formControlName="event_date" name="event_date" required
              class="placeholder:text-slate-400 placeholder:text-[14px] placeholder:italic w-full border border-gray-300 rounded-md p-3 focus:ring-2 focus:ring-violet-500 outline-none" />
            @if(createEventForm.get('event_date')?.touched &&
            createEventForm.get('event_date')?.errors?.['required']){

            <p class="text-[13px] text-red-400">
              Please add a date
            </p>
            }
          </div>
          <div>
            <label class="block font-semibold mb-2 text-gray-700">Event time <span class="text-red-400">*</span></label>
            <input type="time" formControlName="event_time" name="event_time" required
              class="placeholder:text-slate-400 placeholder:text-[14px] placeholder:italic w-full border border-gray-300 rounded-md p-3 focus:ring-2 focus:ring-violet-500 outline-none" />
            @if(createEventForm.get('event_time')?.touched &&
            createEventForm.get('event_time')?.errors?.['required']){

            <p class="text-[13px] text-red-400">
              Please add an event time
            </p>
            }
          </div>
          <div>
            <label class="block font-semibold mb-2 text-gray-700">Category <span class="text-red-400">*</span></label>
            <select name="category" id=""
              class="placeholder:text-slate-400 placeholder:text-[14px] placeholder:italic w-full border border-gray-300 rounded-md p-3 focus:ring-2 focus:ring-violet-500 outline-none"
              formControlName="category" [value]="createEventForm.value.category">
              <option value="" disabled selected hidden>Select Category</option>
              @for(cat of allCategories; track cat.id){
              <option [value]="cat.id">{{cat.name}}</option>
              }
            </select>
            @if(createEventForm.get('category')?.touched &&
            createEventForm.get('category')?.errors?.['required']){

            <p class="text-[13px] text-red-400">
              Please select a category
            </p>
            }
          </div>
        </div>


        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 items-end justify-between">
          <div>
            <label class="block font-semibold mb-2 text-gray-700">Location <span class="text-red-400">*</span></label>
            <input type="text" formControlName="location" name="location" placeholder="Accra, Ghana"
              class="placeholder:text-slate-400 placeholder:text-[14px] placeholder:italic w-full border border-gray-300 rounded-md p-3 focus:ring-2 focus:ring-violet-500 outline-none" />
            @if(createEventForm.get('location')?.touched &&
            createEventForm.get('location')?.errors?.['required']){

            <p class="text-[13px] text-red-400">
              Please add a location
            </p>
            }
          </div>
        </div>


        <div class="flex justify-end">
          <button  (click)="openDrawer()" type="button"
            class="bg-violet-800 hover:bg-violet-800 cursor-pointer text-white px-6 py-2 rounded-md font-semibold shadow-sm transition">
            Add Tickets
          </button>
        </div>
      </form>
    </section>
  </main>
</div>
<div [class.hidden]="!isDrawerOpen" (click)="closeDrawer()"
  class="z-200 w-full h-screen absolute fixed bg-black top-0 left-0 opacity-[0.5]"></div>
<div
  class="fixed top-0 z-200 right-0 w-full sm:w-[400px] h-full bg-white shadow-2xl z-50 transform transition-transform duration-300 ease-in-out"
  [class.translate-x-full]="!isDrawerOpen">
  <div class="p-6 flex flex-col h-full">
    <h3 class="text-xl font-semibold mb-4">Add Tickets</h3>

    <div class="flex space-x-2 mb-4">
      <button (click)="handleType('Paid')" [class.border-violet-500]="isPaid"
        class="flex-1 bg-transparent border border-gray-300 rounded-md py-2 font-medium text-slate-800">
        Paid
      </button>
      <button (click)="handleType('Free')" [class.border-violet-500]="isFree"
        class="flex-1 border border-gray-300 bg-transparent rounded-md py-2 font-medium text-slate-800">
        Free
      </button>
      <button [class.border-violet-500]="isDonation" (click)="handleType('Donation')"
        class="flex-1 bg-transparent border border-gray-300 rounded-md py-2 font-medium text-slate-800">
        Donation
      </button>
    </div>

    <form class="flex-1 overflow-y-auto space-y-4 px-2" [formGroup]="ticketForm">
      <div>
        <label class="block text-gray-700 font-medium mb-1">Ticket Name <span class="text-red-400">*</span></label>
        <input type="text" formControlName="name"
          class="placeholder:text-slate-400 placeholder:text-[14px] placeholder:italic w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-violet-500 outline-none"
          placeholder="Could be the name of your Event" />
          @if(ticketForm.get('name')?.touched &&
          ticketForm.get('name')?.errors?.['required']){

          <p class="text-[13px] text-red-400">
            Please provide a ticket name
          </p>
          }
      </div>

      <div>
        <label class="block text-gray-700 font-medium mb-1">Available quantity <span class="text-red-400">*</span></label>
        <input type="number"
          class="placeholder:text-slate-400 placeholder:text-[14px] placeholder:italic w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-violet-500 outline-none"
          placeholder="Enter quantity" formControlName="quantity" [value]="createEventForm.value.capacity"
          onkeydown="return event.key !== 'e' && event.key !== 'E' && event.key !== '+' && event.key !== '-'" />
          @if(ticketForm.get('quantity')?.touched &&
          ticketForm.get('quantity')?.errors?.['required']){

          <p class="text-[13px] text-red-400">
            Please this field must not be empty
          </p>
          }
      </div>

      <div>
        <label class="block text-gray-700 font-medium mb-1">Price <span class="text-red-400">*</span></label>
        <input onkeydown="return event.key !== 'e' && event.key !== 'E' && event.key !== '+' && event.key !== '-'"
          formControlName="price" type="number" [value]="ticketForm.value.price"
          ngClass="{'italic text-slate-400' : ticketForm.value.type !== 'Paid'}" placeholder="Enter ticket Price"
          class="placeholder:text-slate-400 placeholder:text-[14px] placeholder:italic w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-violet-500 outline-none" />
          @if(ticketForm.get('price')?.touched &&
          ticketForm.get('price')?.errors?.['required']){

          <p class="text-[13px] text-red-400">
            Please this field must not be empty
          </p>
          }
      </div>

      <div class="grid grid-cols-2 gap-4">
        <div>
          <label class="block text-gray-700 font-medium mb-1">Sales start <span class="text-red-400">*</span></label>
          <input formControlName="event_start_date" type="date"
            class="w-full border border-gray-300 rounded-md px-3 py-2" />
            @if(ticketForm.get('event_start_date')?.touched &&
          ticketForm.get('event_start_date')?.errors?.['required']){

          <p class="text-[13px] text-red-400">
            Please this field must not be empty
          </p>
          }
        </div>
        <div>
          <label class="block text-gray-700 font-medium mb-1">Start time <span class="text-red-400">*</span></label>
          <input formControlName="event_start_time" type="time"
            class="w-full border border-gray-300 rounded-md px-3 py-2" />
            @if(ticketForm.get('event_start_time')?.touched &&
          ticketForm.get('event_start_time')?.errors?.['required']){

          <p class="text-[13px] text-red-400">
            Please this field must not be empty
          </p>
          }
        </div>

        <div>
          <label class="block text-gray-700 font-medium mb-1">Sales end <span class="text-red-400">*</span></label>
          <input formControlName="event_end_date" type="date"
            class="w-full border border-gray-300 rounded-md px-3 py-2" />
            @if(ticketForm.get('event_end_date')?.touched &&
          ticketForm.get('event_end_date')?.errors?.['required']){

          <p class="text-[13px] text-red-400">
            Please this field must not be empty
          </p>
          }
        </div>
        <div>
          <label class="block text-gray-700 font-medium mb-1">End time <span class="text-red-400">*</span></label>
          <input formControlName="event_end_time" type="time"
            class="w-full border border-gray-300 rounded-md px-3 py-2" />
            @if(ticketForm.get('event_end_time')?.touched &&
          ticketForm.get('event_end_time')?.errors?.['required']){

          <p class="text-[13px] text-red-400">
            Please this field must not be empty
          </p>
          }
        </div>
      </div>
    </form>

    <div class="flex justify-between mt-6">
      <button (click)="closeDrawer()" class="px-4 py-2 border border-gray-300 rounded-md font-medium">
        Cancel
      </button>
      <button (click)="onSubmit()" class="px-4 py-2 bg-violet-600 text-white rounded-md hover:bg-violet-700">
        @if(loading){Loading...}@else{Save Event}
      </button>
    </div>
  </div>
</div>